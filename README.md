# üß† Local-Deep-Agents-from-Scratch
LocalDeepAgents_01

–°–æ–∑–¥–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω—ã—Ö Deep Agents –Ω–∞ –±–∞–∑–µ **LangGraph**, **LLMs**, **—Ñ–∞–π–ª–æ–≤–æ–π –ø–∞–º—è—Ç–∏**, **–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è** –∏ **—Å—É–±–∞–≥–µ–Ω—Ç–æ–≤**.

---

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã:

https://github.com/langchain-ai/deep-agents-from-scratch

---

# üìå –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–í–≤–µ–¥–µ–Ω–∏–µ](#–≤–≤–µ–¥–µ–Ω–∏–µ)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Deep Agent](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-deep-agent)
3. [–ë–∞–∑–æ–≤—ã–π —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –±–ª–æ–∫: create_react_agent](#–±–∞–∑–æ–≤—ã–π-—Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π-–±–ª–æ–∫-create_react_agent)
4. [–ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ todo-–ª–∏—Å—Ç—ã](#–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ-—á–µ—Ä–µ–∑-todo-–ª–∏—Å—Ç—ã)
5. [–í–Ω–µ—à–Ω—è—è –ø–∞–º—è—Ç—å: —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞](#–≤–Ω–µ—à–Ω—è—è-–ø–∞–º—è—Ç—å-—Ñ–∞–π–ª–æ–≤–∞—è-—Å–∏—Å—Ç–µ–º–∞)
6. [–°—É–±–∞–≥–µ–Ω—Ç—ã –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ](#—Å—É–±–∞–≥–µ–Ω—Ç—ã-–∏-–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
7. [Think-tool: —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è —Ä–µ—Ñ–ª–µ–∫—Å–∏—è](#think-tool-—É–ø—Ä–∞–≤–ª—è–µ–º–∞—è-—Ä–µ—Ñ–ª–µ–∫—Å–∏—è)
8. [–°–±–æ—Ä–∫–∞ Deep Research Agent](#—Å–±–æ—Ä–∫–∞-deep-research-agent)
9. [DeepAgents ‚Äî –≥–æ—Ç–æ–≤–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è](#deepagents--–≥–æ—Ç–æ–≤–∞—è-–∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è)
10. [–ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞](#–ø—Ä–∏–º–µ—Ä—ã-–∫–æ–¥–∞)
11. [–ó–∞–∫–ª—é—á–µ–Ω–∏–µ](#–∑–∞–∫–ª—é—á–µ–Ω–∏–µ)

---

# üß≠ –í–≤–µ–¥–µ–Ω–∏–µ

Deep Agents ‚Äî —ç—Ç–æ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥ –∫ —Å–æ–∑–¥–∞–Ω–∏—é –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤, —É—Å—Ç–æ–π—á–∏–≤—ã—Ö –∫ –¥–ª–∏–Ω–Ω—ã–º –∑–∞–¥–∞—á–∞–º (20‚Äì100+ —à–∞–≥–æ–≤).  
–û—Å–Ω–æ–≤–∞–Ω –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–∞—Ö —Å–∏—Å—Ç–µ–º:

- **Manus**
- **Claude Code**
- **OpenAI Deep Research**
- **Anthropic Multi-Agent Researcher**

–ö–ª—é—á–µ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã:

- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (todos)  
- –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ offloading (files)  
- –°—É–±–∞–≥–µ–Ω—Ç—ã  
- –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã  
- –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ LangGraph

![DeepAgents_01.png](Images/DeepAgents_01.png)

---

# üß± –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Deep Agent

Deep Agent —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —á–µ—Ç—ã—Ä—ë—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:

```

‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Supervisor        ‚îÇ
‚îÇ     (–≥–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ Delegation
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ        Subagent          ‚îÇ
‚îÇ  (–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å, –∫–æ–¥–µ—Ä)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
           ‚îÇ Tools
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  File System  |  Todos   ‚îÇ
‚îÇ (–≤–Ω–µ—à–Ω—è—è –ø–∞–º—è—Ç—å –∞–≥–µ–Ω—Ç–∞   ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

````

---

# ‚öôÔ∏è –ë–∞–∑–æ–≤—ã–π —Å—Ç—Ä–æ–∏—Ç–µ–ª—å–Ω—ã–π –±–ª–æ–∫: `create_react_agent`

LangGraph –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –ø—Ä–µ–¥–Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–≥–µ–Ω—Ç ReAct:

```python
from langgraph.prebuilt import create_react_agent

agent = create_react_agent(
    model=my_llm,
    tools=[...],
    prompt="You are a helpful assistant."
)
````

–§—É–Ω–∫—Ü–∏–∏:

* —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º,
* –≤—ã–∑–æ–≤—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤,
* —É—Å–ª–æ–≤–Ω—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã,
* –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≥—Ä–∞—Ñ–∞,
* –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Command.


![graph_01.PNG](Images/graph_01.PNG)

---

# üìù –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ todo-–ª–∏—Å—Ç—ã

–ü—Ä–∏–º–µ—Ä todo-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:

```python
@tool
def write_todos(todos: list[Todo], state: InjectedState, tool_call_id):
    return Command(update={
        "todos": todos,
        "messages": [ToolMessage("Todos updated", tool_call_id)]
    })
```

Todo-–ª–∏—Å—Ç —Å–ª—É–∂–∏—Ç:

* –ø–ª–∞–Ω–æ–º –¥–µ–π—Å—Ç–≤–∏—è,
* —Ç—Ä–µ–∫–µ—Ä–æ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞,
* –Ω–∞–±—Ä–æ—Å–∫–æ–º —Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏–∏ –∞–≥–µ–Ω—Ç–∞.

---

# üíæ –í–Ω–µ—à–Ω—è—è –ø–∞–º—è—Ç—å: —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

Deep Agent —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –Ω–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ LLM, –∞ –≤ state.files:

```python
files = {
  "page_1.md": "... markdown ...",
  "user_request.txt": "Find info about MCP"
}
```

–ü—Ä–∏–º–µ—Ä—ã –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤:

```python
@tool
def write_file(path: str, content: str, state: InjectedState, tool_call_id):
    return Command(update={"files": {path: content}})
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

* raw tool calls,
* —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤,
* –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö,
* –±–æ–ª—å—à–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤.

---

# ü§ñ –°—É–±–∞–≥–µ–Ω—Ç—ã –∏ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–°—É–±–∞–≥–µ–Ω—Ç—ã ‚Äî —ç—Ç–æ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –∞–≥–µ–Ω—Ç—ã —Å–æ —Å–≤–æ–∏–º–∏ –ø—Ä–æ–º–ø—Ç–∞–º–∏.

–ü—Ä–∏–º–µ—Ä –æ–ø–∏—Å–∞–Ω–∏—è —Å—É–±–∞–≥–µ–Ω—Ç–∞:

```python
research_subagent = {
  "name": "research-agent",
  "description": "Performs deep research tasks.",
  "prompt": "...",
  "tools": ["tavily_search", "read_file"]
}
```

–ì–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç –∏—Ö —á–µ—Ä–µ–∑ `task_tool`.

---

# üß† Think-tool: —É–ø—Ä–∞–≤–ª—è–µ–º–∞—è —Ä–µ—Ñ–ª–µ–∫—Å–∏—è

–≠—Ç–æ no-op –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç:

```python
@tool
def think_tool(thought: str):
    return f"[THOUGHT]: {thought}"
```

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è:

* –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞,
* –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –æ—à–∏–±–æ–∫,
* –∞—É–¥–∏—Ç–∞ reasoning.

---

# üèó –°–±–æ—Ä–∫–∞ Deep Research Agent

–°–∏—Å—Ç–µ–º–∞ –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç:

* todos,
* files,
* subagents,
* think-tool,
* Tavily search,
* summary –º–æ–¥–µ–ª–∏.

Flow:

1. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å ‚Üí —Ñ–∞–π–ª
2. –°–æ—Å—Ç–∞–≤–∏—Ç—å todo-–ª–∏—Å—Ç
3. –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É research-agent
4. –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (markdown)
5. –û–±–Ω–æ–≤–∏—Ç—å todo
6. –í–µ—Ä–Ω—É—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á—ë—Ç

---

# üì¶ DeepAgents ‚Äî –≥–æ—Ç–æ–≤–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ DeepAgents —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç:

* todo-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã,
* —Ñ–∞–π–ª–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É,
* task_tool,
* think-tool,
* supervisor + subagent –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—É.

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –¥–æ—Å—Ç—É–ø–µ–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ Resources.

---

# üß™ –ü—Ä–∏–º–µ—Ä—ã –∫–æ–¥–∞

–ü—Ä–∏–º–µ—Ä –≤—ã–∑–æ–≤–∞ –∞–≥–µ–Ω—Ç–∞:

```python
result = agent.invoke({"messages": [
  {"role": "user", "content": "Give me an overview of MCP"}
]})
```

–ü—Ä–∏–º–µ—Ä —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–æ–≤:

```python
agent_state["files"]["page_1.md"]
```

---


# üß† –û–±–∑–æ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞ –º–æ–¥—É–ª–µ–π Deep Agents (from scratch)

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –¥–∞—ë—Ç **—Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ–±–∑–æ—Ä –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∫–æ–¥–∞** –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:

- `state.py` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞  
- `prompts.py` ‚Äî –ø—Ä–æ–º–ø—Ç—ã –∏ –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤  
- `fs_tools.py` (—É—Å–ª–æ–≤–Ω–æ–µ –∏–º—è) ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞  
- `todo_tools.py` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TODO-—Å–ø–∏—Å–∫–æ–º  
- `research_tools.py` ‚Äî –≤–µ–±-–ø–æ–∏—Å–∫ –∏ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è  
- `task_tool.py` ‚Äî –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á —Å—É–±–∞–≥–µ–Ω—Ç–∞–º  

–¶–µ–ª—å: –ø–æ–º–æ—á—å –±—ã—Å—Ç—Ä–æ –ø–æ–Ω—è—Ç—å **–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** –∏ **–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∫–∞–∂–¥–æ–≥–æ –º–æ–¥—É–ª—è**, –Ω–µ –∑–∞—Ä—ã–≤–∞—è—Å—å —Å—Ä–∞–∑—É –≤ –¥–µ—Ç–∞–ª–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.


* `state` ‚Äî –±–∞–∑–æ–≤—ã–π –º–æ–¥—É–ª—å —Å–æ—Å—Ç–æ—è–Ω–∏—è, –Ω–∏ –æ—Ç –∫–æ–≥–æ –≤–Ω—É—Ç—Ä–∏ –ø–∞–∫–µ—Ç–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç.
* `prompts` ‚Äî –±–∞–∑–æ–≤—ã–π –º–æ–¥—É–ª—å —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —à–∞–±–ª–æ–Ω–æ–≤, —Ç–æ–∂–µ –Ω–∏ –æ—Ç –∫–æ–≥–æ –≤–Ω—É—Ç—Ä–∏ –ø–∞–∫–µ—Ç–∞ –Ω–µ –∑–∞–≤–∏—Å–∏—Ç.
* `todo_tools`:

  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DeepAgentState` –∏ `Todo` –∏–∑ `state`;
  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `WRITE_TODOS_DESCRIPTION` –∏–∑ `prompts`.
* `file_tools`:

  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DeepAgentState` –∏–∑ `state`;
  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ `LS_DESCRIPTION`, `READ_FILE_DESCRIPTION`, `WRITE_FILE_DESCRIPTION` –∏–∑ `prompts`.
* `research_tools`:

  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DeepAgentState` –∏–∑ `state`;
  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `SUMMARIZE_WEB_SEARCH` –∏–∑ `prompts`.
* `task_tool`:

  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DeepAgentState` –∏–∑ `state`;
  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `TASK_DESCRIPTION_PREFIX` –∏–∑ `prompts`.

–¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º, `state` –∏ `prompts` ‚Äî –æ–±—â–∏–µ –±–∞–∑–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –∞ –≤—Å–µ ‚Äútool‚Äù-–º–æ–¥—É–ª–∏ –∑–∞–≤–∏—Å—è—Ç –æ—Ç –Ω–∏—Ö.

![ComponentDiagram_01.png](Images/ComponentDiagram_01.png)

---

## üìÇ 1. `state.py` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞ (DeepAgentState)

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ **—Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∞–≥–µ–Ω—Ç–∞**, –Ω–∞ –∫–æ—Ç–æ—Ä–æ–º —Å—Ç—Ä–æ–∏—Ç—Å—è –≤–µ—Å—å Deep Agent:

- –ø–æ–¥–¥–µ—Ä–∂–∫–∞ **TODO-—Å–ø–∏—Å–∫–æ–≤** (–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ),
- –ø–æ–¥–¥–µ—Ä–∂–∫–∞ **–≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π —Ñ–∞–π–ª–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã** (–∫–æ–Ω—Ç–µ–∫—Å—Ç –∫–∞–∫ —Ñ–∞–π–ª—ã),
- –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ **—Å–ª–∏—è–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è** —á–µ—Ä–µ–∑ —Ä–µ–¥—å—é—Å–µ—Ä.

### –ö–ª—é—á–µ–≤—ã–µ —Å—É—â–Ω–æ—Å—Ç–∏

#### `Todo`

```python
class Todo(TypedDict):
    content: str
    status: Literal["pending", "in_progress", "completed"]
````

**–î–ª—è —á–µ–≥–æ:**

* –æ–ø–∏—Å—ã–≤–∞–µ—Ç –æ–¥–Ω—É –∑–∞–¥–∞—á—É –≤ TODO-—Å–ø–∏—Å–∫–µ:

  * `content` ‚Äî —Ç–µ–∫—Å—Ç –∑–∞–¥–∞—á–∏,
  * `status` ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

#### `file_reducer(left, right)`

```python
def file_reducer(left, right):
    if left is None:
        return right
    elif right is None:
        return left
    else:
        return {**left, **right}
```

**–î–ª—è —á–µ–≥–æ:**

* –∑–∞–¥–∞—ë—Ç –ø—Ä–∞–≤–∏–ª–∞, –∫–∞–∫ –æ–±—ä–µ–¥–∏–Ω—è—Ç—å –¥–≤–∞ —Å–ª–æ–≤–∞—Ä—è —Ñ–∞–π–ª–æ–≤:

  * `right` –ø–µ—Ä–µ–∫—Ä—ã–≤–∞–µ—Ç `left`,
  * –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–∞–∫ —Ä–µ–¥—å—é—Å–µ—Ä –¥–ª—è –ø–æ–ª—è `files` –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏.

#### `DeepAgentState(AgentState)`

```python
class DeepAgentState(AgentState):
    todos: NotRequired[list[Todo]]
    files: Annotated[NotRequired[dict[str, str]], file_reducer]
```

**–î–ª—è —á–µ–≥–æ:**

* —Ä–∞—Å—à–∏—Ä—è–µ—Ç –±–∞–∑–æ–≤—ã–π `AgentState` –∏–∑ LangChain/LangGraph,
* –¥–æ–±–∞–≤–ª—è–µ—Ç:

  * `todos` ‚Äî —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á,
  * `files` ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è –§–° (–∏–º—è —Ñ–∞–π–ª–∞ ‚Üí —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ),
* –ø–æ–¥–∫–ª—é—á–∞–µ—Ç —Ä–µ–¥—å—é—Å–µ—Ä `file_reducer` –∫ `files`.

**–†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ:**

–≠—Ç–æ **—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–º—è—Ç–∏** Deep Agent:

* `messages` (–Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è) ‚Äî –∫—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω–∞—è –ø–∞–º—è—Ç—å,
* `todos` ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ,
* `files` ‚Äî –¥–æ–ª–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –∏ –æ–±—ä—ë–º–Ω–∞—è –ø–∞–º—è—Ç—å.

---

## üßæ 2. `prompts.py` ‚Äî –ø—Ä–æ–º–ø—Ç—ã –∏ –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ú–æ–¥—É–ª—å —Å–æ–¥–µ—Ä–∂–∏—Ç **–≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã**, –∫–æ—Ç–æ—Ä—ã–µ —É–ø—Ä–∞–≤–ª—è—é—Ç –ø–æ–≤–µ–¥–µ–Ω–∏–µ–º –∞–≥–µ–Ω—Ç–∞:

* –æ–ø–∏—Å–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥–ª—è LLM,
* —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Å–æ–±–ª—é–¥–µ–Ω–∏—è —Å—Ç—Ä–∞—Ç–µ–≥–∏–π,
* –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å—É–±–∞–≥–µ–Ω—Ç–æ–≤ –∏ —Å—É–ø–µ—Ä–∞–≥–µ–Ω—Ç–∞.

### –û—Å–Ω–æ–≤–Ω—ã–µ –±–ª–æ–∫–∏

#### TODO-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

* `WRITE_TODOS_DESCRIPTION`
  ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ `write_todos`.

* `TODO_USAGE_INSTRUCTIONS`
  ‚Äî –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è —Å—É–ø–µ—Ä–∞–≥–µ–Ω—Ç–∞:

  * –∫–æ–≥–¥–∞ —Å–æ–∑–¥–∞–≤–∞—Ç—å TODO-–ª–∏—Å—Ç,
  * –∫–∞–∫ –µ–≥–æ –æ–±–Ω–æ–≤–ª—è—Ç—å,
  * –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–ª–∞–Ω–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è.

#### –§–∞–π–ª–æ–≤–∞—è –ø–æ–¥—Å–∏—Å—Ç–µ–º–∞

* `LS_DESCRIPTION`
* `READ_FILE_DESCRIPTION`
* `WRITE_FILE_DESCRIPTION`
* `FILE_USAGE_INSTRUCTIONS`

–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:

* –∫–∞–∫ `description` –¥–ª—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ `ls`, `read_file`, `write_file`,
* –∫–∞–∫ —á–∞—Å—Ç—å —Å–∏—Å—Ç–µ–º–Ω–æ–π –ø–æ–¥—Å–∫–∞–∑–∫–∏ (supervisor prompt).

#### –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü

* `SUMMARIZE_WEB_SEARCH`

–®–∞–±–ª–æ–Ω –ø—Ä–æ–º–ø—Ç–∞ –¥–ª—è summarization-–º–æ–¥–µ–ª–∏:

* –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `{webpage_content}` –∏ `{date}`,
* –ø—Ä–æ—Å–∏—Ç:

  * –∫—Ä–∞—Ç–∫–æ –ø–µ—Ä–µ—Å–∫–∞–∑–∞—Ç—å —Å–º—ã—Å–ª,
  * —É–∫–∞–∑–∞—Ç—å —Ç–∏–ø –∫–æ–Ω—Ç–µ–Ω—Ç–∞,
  * –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –∏–º—è —Ñ–∞–π–ª–∞,
* –æ–∂–∏–¥–∞–µ—Ç JSON-–æ—Ç–≤–µ—Ç —Å –ø–æ–ª—è–º–∏ `filename` –∏ `summary`.

#### –ü—Ä–æ–º–ø—Ç research-—Å—É–±–∞–≥–µ–Ω—Ç–∞

* `RESEARCHER_INSTRUCTIONS`

–û–ø–∏—Å—ã–≤–∞–µ—Ç:

* –∫–∞–∫ –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –≤—ã–ø–æ–ª–Ω—è—Ç—å –≤–µ–±-–∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ,
* –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `tavily_search` –∏ `think_tool`,
* –ª–∏–º–∏—Ç—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É tool calls,
* –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è.

#### –î–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—É–±–∞–≥–µ–Ω—Ç–∞–º

* `TASK_DESCRIPTION_PREFIX`
* `SUBAGENT_USAGE_INSTRUCTIONS`

–û–ø–∏—Å—ã–≤–∞—é—Ç:

* –∫–∞–∫–∏–µ —Å—É–±–∞–≥–µ–Ω—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã,
* –∫–∞–∫ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏ —á–µ—Ä–µ–∑ `task(description, subagent_type)`,
* –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ —Å—É–±–∞–≥–µ–Ω—Ç—ã,
* –ª–∏–º–∏—Ç—ã –ø–æ —á–∏—Å–ª—É –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–π –∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∞–≥–µ–Ω—Ç–æ–≤.

---

## üìÅ 3. `fs_tools.py` ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

*(–ò–º—è —É—Å–ª–æ–≤–Ω–æ–µ, –æ—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º –∫–æ–¥–∞)*

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑—É–µ—Ç —Ç—Ä–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞:

* `ls` ‚Äî —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤,
* `read_file` ‚Äî —á—Ç–µ–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ,
* `write_file` ‚Äî –∑–∞–ø–∏—Å—å/–ø–µ—Ä–µ–∑–∞–ø–∏—Å—å —Ñ–∞–π–ª–∞.

–†–∞–±–æ—Ç–∞–µ—Ç –ø–æ–≤–µ—Ä—Ö `DeepAgentState.files`.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `ls(state) -> list[str]`

```python
@tool(description=LS_DESCRIPTION)
def ls(state: Annotated[DeepAgentState, InjectedState]) -> list[str]:
    return list(state.get("files", {}).keys())
```

* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–º—ë–Ω —Ñ–∞–π–ª–æ–≤,
* `state` –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –∫–∞–∫ `InjectedState` ‚Äî –º–æ–¥–µ–ª—å –µ–≥–æ –Ω–µ –≤–∏–¥–∏—Ç.

#### `read_file(file_path, state, offset=0, limit=2000) -> str`

* –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ñ–∞–π–ª,
* –µ—Å–ª–∏ –ø—É—Å—Ç–æ–π ‚Äî –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ,
* –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —á—Ç–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–æ—á–Ω–æ —Å `offset` –∏ `limit`,
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Ç—Ä–æ–∫–∏ —Å –Ω–æ–º–µ—Ä–∞–º–∏ (–∫–∞–∫ `cat -n`),
* –Ω–µ –º–µ–Ω—è–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ, —Ç–æ–ª—å–∫–æ —á–∏—Ç–∞–µ—Ç.

#### `write_file(file_path, content, state, tool_call_id) -> Command`

* –æ–±–Ω–æ–≤–ª—è–µ—Ç / —Å–æ–∑–¥–∞—ë—Ç —Ñ–∞–π–ª –≤ `state.files`,
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Command(update={...})`, –∫–æ—Ç–æ—Ä—ã–π:

  * –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç —Ñ–∞–π–ª,
  * –¥–æ–±–∞–≤–ª—è–µ—Ç `ToolMessage("Updated file ...")`.

**–†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ:**

* —Ö—Ä–∞–Ω–∏—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞),
* —Ö—Ä–∞–Ω–∏—Ç –∑–∞–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è,
* –ø–æ–º–æ–≥–∞–µ—Ç –∞–≥–µ–Ω—Ç—É —ç–∫–æ–Ω–æ–º–∏—Ç—å —Ç–æ–∫–µ–Ω—ã,
* –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –æ–±—Ä–∞—Ç–∏–º–æ—Å—Ç—å –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

---

## ‚úÖ 4. `todo_tools.py` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ TODO-—Å–ø–∏—Å–∫–æ–º

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–û–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:

* –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è/–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è TODO-–ª–∏—Å—Ç–∞;
* –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ —Ç–µ–∫—É—â–∏—Ö –∑–∞–¥–∞—á.

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

#### `write_todos(todos, tool_call_id) -> Command`

```python
@tool(description=WRITE_TODOS_DESCRIPTION, parse_docstring=True)
def write_todos(
    todos: list[Todo], tool_call_id: Annotated[str, InjectedToolCallId]
) -> Command:
    return Command(
        update={
            "todos": todos,
            "messages": [
                ToolMessage(f"Updated todo list to {todos}", tool_call_id=tool_call_id)
            ],
        }
    )
```

* –ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ `Todo`,
* –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª–µ `todos` –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏,
* –¥–æ–±–∞–≤–ª—è–µ—Ç `ToolMessage` –¥–ª—è —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–∏.

#### `read_todos(state, tool_call_id) -> str`

```python
@tool(parse_docstring=True)
def read_todos(
    state: Annotated[DeepAgentState, InjectedState],
    tool_call_id: Annotated[str, InjectedToolCallId],
) -> str:
    ...
```

* —á–∏—Ç–∞–µ—Ç `state["todos"]`,
* –µ—Å–ª–∏ –ø—É—Å—Ç–æ ‚Äî —Å–æ–æ–±—â–∞–µ—Ç –æ–± –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏,
* —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á —Å —ç–º–æ–¥–∑–∏ –ø–æ —Å—Ç–∞—Ç—É—Å—É.

**–†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ:**

* –¥–∞—ë—Ç –∞–≥–µ–Ω—Ç—É ¬´–æ—Å—å¬ª –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Ä–∞–±–æ—Ç—ã,
* –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è—Ö:

  * —Å–æ–∑–¥–∞—Ç—å TODO –≤ –Ω–∞—á–∞–ª–µ,
  * –ø–µ—Ä–µ—á–∏—Ç—ã–≤–∞—Ç—å TODO –ø–æ—Å–ª–µ —à–∞–≥–æ–≤,
  * –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –ø–æ –º–µ—Ä–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è.

---

## üîé 5. `research_tools.py` ‚Äî –≤–µ–±-–ø–æ–∏—Å–∫ –∏ —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑—É–µ—Ç **–ø–æ–∏—Å–∫–æ–≤—É—é —á–∞—Å—Ç—å** Deep Agent:

* –≤–µ–±-–ø–æ–∏—Å–∫ —á–µ—Ä–µ–∑ Tavily,
* —Å–∫–∞—á–∏–≤–∞–Ω–∏–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ –ø–æ URL,
* –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è HTML ‚Üí markdown,
* —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–µ—Ä–µ–∑ LLM,
* —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ —Ñ–∞–π–ª—ã,
* –≤–æ–∑–≤—Ä–∞—Ç –∫–æ–º–ø–∞–∫—Ç–Ω–æ–π —Å–≤–æ–¥–∫–∏ –≤ —Å–æ–æ–±—â–µ–Ω–∏—è.

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

#### –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã

```python
summarization_model = init_chat_model(model="openai:gpt-4o-mini")
tavily_client = TavilyClient()
```

* –º–æ–¥–µ–ª—å –¥–ª—è —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏–∏ (`with_structured_output`),
* –∫–ª–∏–µ–Ω—Ç Tavily –¥–ª—è –ø–æ–∏—Å–∫–∞.

#### `Summary` (Pydantic)

```python
class Summary(BaseModel):
    filename: str
    summary: str
```

* —Å—Ö–µ–º–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞ –¥–ª—è LLM,
* –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ–ª—É—á–∞—Ç—å JSON —Å –∏–º–µ–Ω–µ–º —Ñ–∞–π–ª–∞ –∏ summary.

#### `run_tavily_search(...) -> dict`

* –æ–±—ë—Ä—Ç–∫–∞ –Ω–∞–¥ `tavily_client.search(...)`,
* –ø—Ä–∏–Ω–∏–º–∞–µ—Ç query, max_results, topic,
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç dict —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞–º–∏ Tavily.

#### `summarize_webpage_content(webpage_content: str) -> Summary`

* –≤—ã–∑—ã–≤–∞–µ—Ç `summarization_model.with_structured_output(Summary)`,
* –ø–æ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–Ω—Ç–µ–Ω—Ç –∏ –¥–∞—Ç—É –≤ `SUMMARIZE_WEB_SEARCH`,
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Summary`,
* –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî fallback: filename = `search_result.md`, summary = –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç.

#### `process_search_results(results: dict) -> list[dict]`

* –∏—Ç–µ—Ä–∏—Ä—É–µ—Ç—Å—è –ø–æ `results['results']`,
* –ø—ã—Ç–∞–µ—Ç—Å—è —Å–∫–∞—á–∞—Ç—å HTML —á–µ—Ä–µ–∑ `httpx.Client`,
* –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ markdown —á–µ—Ä–µ–∑ `markdownify`,
* –≤—ã–∑—ã–≤–∞–µ—Ç `summarize_webpage_content`,
* –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∏–º—è —Ñ–∞–π–ª–∞ (UUID+base64),
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫:

  * `url`, `title`, `summary`, `filename`, `raw_content`.

#### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `tavily_search(...) -> Command`

```python
@tool(parse_docstring=True)
def tavily_search(
    query: str,
    state: Annotated[DeepAgentState, InjectedState],
    tool_call_id: Annotated[str, InjectedToolCallId],
    max_results: Annotated[int, InjectedToolArg] = 1,
    topic: Annotated[Literal["general", "news", "finance"], InjectedToolArg] = "general",
) -> Command:
    ...
```

* –¥–µ–ª–∞–µ—Ç –ø–æ–∏—Å–∫ `run_tavily_search`,
* –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã `process_search_results`,
* —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∂–¥—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `files[filename]` –≤ –≤–∏–¥–µ:

  * –∑–∞–≥–æ–ª–æ–≤–æ–∫,
  * URL,
  * –∑–∞–ø—Ä–æ—Å,
  * –¥–∞—Ç–∞,
  * summary,
  * raw content (markdown),
* —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –∫–æ–º–ø–∞–∫—Ç–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–ª—è `ToolMessage`:

  * —Å–ø–∏—Å–æ–∫ —Ñ–∞–π–ª–æ–≤ + –∫—Ä–∞—Ç–∫–∏–µ summary,
* –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `Command`, –æ–±–Ω–æ–≤–ª—è—é—â–∏–π `files` –∏ `messages`.

#### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `think_tool(reflection: str) -> str`

* no-op –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Ä–µ—Ñ–ª–µ–∫—Å–∏–∏:

  * –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è,
  * –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `"Reflection recorded: ..."`.

**–†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ:**

* —Ä–∞–∑–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç:

  * –±–æ–ª—å—à–∏–µ —Ç–µ–∫—Å—Ç—ã ‚Üí –≤ —Ñ–∞–π–ª—ã,
  * –∫–æ—Ä–æ—Ç–∫–∏–µ summary ‚Üí –≤ messages;
* –¥–∞—ë—Ç –∞–≥–µ–Ω—Ç—É —á—ë—Ç–∫–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã;
* —á–µ—Ä–µ–∑ think-tool –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–æ–µ ¬´thinking¬ª.

---

## ü§ù 6. `task_tool.py` ‚Äî –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á —Å—É–±–∞–≥–µ–Ω—Ç–∞–º

### –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º:

* —Å–æ–∑–¥–∞–Ω–∏—è —Å—É–±–∞–≥–µ–Ω—Ç–æ–≤,
* –∏–∑–æ–ª—è—Ü–∏–∏ –∏—Ö –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞,
* –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º –∑–∞–¥–∞—á —á–µ—Ä–µ–∑ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `task()`.

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã

#### `SubAgent` (TypedDict)

```python
class SubAgent(TypedDict):
    name: str
    description: str
    prompt: str
    tools: NotRequired[list[str]]
```

* –æ–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å—É–±–∞–≥–µ–Ω—Ç–∞:

  * –∏–º—è,
  * –æ–ø–∏—Å–∞–Ω–∏–µ (–¥–ª—è —Å—É–ø–µ—Ä–∞–≥–µ–Ω—Ç–∞),
  * —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç,
  * —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ (–ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö).

#### `_create_task_tool(tools, subagents, model, state_schema) -> tool`

* –ø—Ä–∏–Ω–∏–º–∞–µ—Ç:

  * –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤,
  * —Å–ø–∏—Å–æ–∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π —Å—É–±–∞–≥–µ–Ω—Ç–æ–≤,
  * –º–æ–¥–µ–ª—å,
  * —Å—Ö–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—è;
* —Å–æ–∑–¥–∞—ë—Ç:

  * —Å–ª–æ–≤–∞—Ä—å `agents[name] = create_agent(...)`,
  * –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `task(...)` —Å –æ–ø–∏—Å–∞–Ω–∏–µ–º `TASK_DESCRIPTION_PREFIX`.

#### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `task(description, subagent_type, state, tool_call_id)`

* –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ `subagent_type` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç;
* –±–µ—Ä—ë—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π —Å—É–±–∞–≥–µ–Ω—Ç;
* **–∏–∑–æ–ª–∏—Ä—É–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç**:

  * –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç `state["messages"] = [{"role": "user", "content": description}]`;
* –≤—ã–∑—ã–≤–∞–µ—Ç `sub_agent.invoke(state)`;
* —Å–æ–±–∏—Ä–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç `Command(update={...})`:

  * –∫–æ–ø–∏—Ä—É–µ—Ç `files` –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞,
  * —Å–æ–∑–¥–∞—ë—Ç `ToolMessage` —Å **–ø–æ—Å–ª–µ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º** —Å—É–±–∞–≥–µ–Ω—Ç–∞.

**–†–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ:**

* –≥–ª–∞–≤–Ω—ã–π –∞–≥–µ–Ω—Ç –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç:

  * ¬´–∏—Å—Å–ª–µ–¥—É–π —Ç–∞–∫—É—é-—Ç–æ —Ç–µ–º—É¬ª,
  * ¬´–ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫¬ª,
  * ¬´—Å—Ä–∞–≤–Ω–∏ X –∏ Y¬ª;
* —Å—É–±–∞–≥–µ–Ω—Ç:

  * —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —á–∏—Å—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ,
  * –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ—ë –∑–∞–¥–∞–Ω–∏–µ,
  * –¥–µ–ª–∞–µ—Ç –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ tool calls.

–≠—Ç–æ –æ—Å–Ω–æ–≤–Ω–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è **deep**-—á–∞—Å—Ç–∏ Deep Agents.

---

## üß© –ö–∞–∫ –≤—Å—ë —Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ

1. **–°–æ—Å—Ç–æ—è–Ω–∏–µ (`state.py`)**
   –î–∞—ë—Ç:

   * `messages`,
   * `todos`,
   * `files`.

2. **–ü—Ä–æ–º–ø—Ç—ã (`prompts.py`)**
   –£–ø—Ä–∞–≤–ª—è—é—Ç:

   * —Ç–µ–º, –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TODO,
   * –∫–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã,
   * –∫–∞–∫ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ,
   * –∫–∞–∫ –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞—Ç—å —Å—É–±–∞–≥–µ–Ω—Ç–∞–º.

3. **–§–∞–π–ª—ã (`fs_tools.py`)**
   –†–µ–∞–ª–∏–∑—É—é—Ç:

   * `ls`, `read_file`, `write_file`.

4. **TODO (`todo_tools.py`)**
   –†–µ–∞–ª–∏–∑—É—é—Ç:

   * `write_todos`, `read_todos`.

5. **–ü–æ–∏—Å–∫ (`research_tools.py`)**
   –†–µ–∞–ª–∏–∑—É–µ—Ç:

   * `tavily_search` (–ø–æ–∏—Å–∫ + —Å—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è + —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ —Ñ–∞–π–ª—ã),
   * `think_tool` (—Ä–µ—Ñ–ª–µ–∫—Å–∏—è).

6. **–°—É–±–∞–≥–µ–Ω—Ç—ã (`task_tool.py`)**
   –†–µ–∞–ª–∏–∑—É—é—Ç:

   * —Å–æ–∑–¥–∞–Ω–∏–µ —Å—É–±–∞–≥–µ–Ω—Ç–æ–≤,
   * –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `task()` –¥–ª—è –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏—è —Å –∏–∑–æ–ª—è—Ü–∏–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞.

![SequenceDiagram_01.png](Images/SequenceDiagram_01.png)

---
## –°–ø–∏—Å–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è LLM

| –ú–æ–¥—É–ª—å  | –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è LLM                                                | –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –º–æ–¥–µ–ª—å                | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                               |
| ------- | ------------------------------------------------------------------- | -------------------------------- | -------------------------------------------------------- |
| `research_tools` | `summarization_model = init_chat_model(model="openai:gpt-4o-mini")` | `openai:gpt-4o-mini`             | –°—É–º–º–∞—Ä–∏–∑–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –≤–µ–±-—Å—Ç—Ä–∞–Ω–∏—Ü, –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞ |
| `task_tool` | `_create_task_tool(..., model, ...) ‚Üí create_agent(model, ...)`     | **–õ—é–±–∞—è**, –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º | –ë–∞–∑–æ–≤–∞—è –º–æ–¥–µ–ª—å –¥–ª—è —Å—É–±-–∞–≥–µ–Ω—Ç–æ–≤ (–¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á)     |
| `todo_tools` | ‚Äî (–Ω–µ—Ç –ø—Ä—è–º–æ–π –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –º–æ–¥–µ–ª–∏)                                 | ‚Äî                                | –õ–∏—à—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è TODO; –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –∞–≥–µ–Ω—Ç–æ–º            |
| `file_tools` | ‚Äî                                                                   | ‚Äî                                | –õ–∏—à—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏                    |
| `state` | ‚Äî                                                                   | ‚Äî                                | –û–ø–∏—Å–∞–Ω–∏–µ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å–æ—Å—Ç–æ—è–Ω–∏—è                             |
| `prompts` | ‚Äî                                                                   | ‚Äî                                | –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –ø—Ä–æ–º–ø—Ç–æ–≤   

---

# üèÅ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

Deep Agents ‚Äî —ç—Ç–æ:

* –º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞,
* —É–ø—Ä–∞–≤–ª—è–µ–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ,
* –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á,
* –≤–Ω–µ—à–Ω—è—è –ø–∞–º—è—Ç—å,
* –º–æ—â–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã.

–ò—Å–ø–æ–ª—å–∑—É—è —ç—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø—ã, –≤—ã –º–æ–∂–µ—Ç–µ —Å–æ–∑–¥–∞–≤–∞—Ç—å:

* –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∞–≥–µ–Ω—Ç—ã,
* –∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º—ã,
* –∫–æ–¥–æ–≤—ã–µ –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç—ã,
* –±–∏–∑–Ω–µ—Å-–∞–≥–µ–Ω—Ç–æ–≤,
* —Å–ª–æ–∂–Ω—ã–µ workflow-–ø–∞–π–ø–ª–∞–π–Ω—ã.

–ì–æ—Ç–æ–≤—ã —Å—Ç—Ä–æ–∏—Ç—å —Å–≤–æ–µ–≥–æ Deep Agent.

---
## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

![debug_01.png](Images/debug_01.png)

![studio_01.png](Images/studio_01.png)


